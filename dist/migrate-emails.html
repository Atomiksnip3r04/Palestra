<!DOCTYPE html>
<html>
<head>
    <title>Migrate User Emails</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB2kwY2t8QqVDfKeC4gh_TuyX_vHNwVuwU",
            authDomain: "ironflow-a9bc9.firebaseapp.com",
            projectId: "ironflow-a9bc9",
            storageBucket: "ironflow-a9bc9.firebasestorage.app",
            messagingSenderId: "254296220548",
            appId: "1:254296220548:web:3549b12f2888144a5cf3d1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const functions = getFunctions(app);

        window.runMigration = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');

            try {
                resultDiv.innerHTML = 'Logging in...';
                await signInWithEmailAndPassword(auth, email, password);
                
                resultDiv.innerHTML = 'Running migration...';
                const migrateUserEmails = httpsCallable(functions, 'migrateUserEmails');
                const result = await migrateUserEmails();
                
                resultDiv.innerHTML = `
                    <h3>Migration Complete!</h3>
                    <p>Migrated: ${result.data.migrated}</p>
                    <p>Skipped (already had email): ${result.data.skipped}</p>
                    <p>Errors: ${result.data.errors}</p>
                    <p>Total users: ${result.data.total}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color:red">Error: ${error.message}</p>`;
            }
        };
    </script>
</head>
<body style="font-family: Arial; padding: 20px; background: #1a1a2e; color: white;">
    <h1>Migrate User Emails</h1>
    <p>This will add root-level email field to all user documents for efficient search.</p>
    
    <div style="margin: 20px 0;">
        <input type="email" id="email" placeholder="Admin email" style="padding: 10px; margin: 5px;"><br>
        <input type="password" id="password" placeholder="Password" style="padding: 10px; margin: 5px;"><br>
        <button onclick="runMigration()" style="padding: 10px 20px; margin: 5px; cursor: pointer;">Run Migration</button>
    </div>
    
    <div id="result" style="margin-top: 20px; padding: 15px; background: #2a2a4e; border-radius: 8px;"></div>
</body>
</html>
